{{define "tripForm" }}
{{ $v := index .Data "mileage-log" }}
<!--<form method="post" action="/mileage-logs/{{$v.ID}}/edit-trips" class="" novalidate>-->
<form hx-post="/mileage-logs/{{$v.ID}}/add-trip" hx-trigger="submit" hx-swap="outerHTML" onsubmit="generateFullOdometerValue()" novalidate>
    {{ $t := index .Data "trip" }}
    <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">
    <div class="row">
        <div class="col">
            <div class="form-group mt-3">
                <label for="trip-day">Day:</label>
                {{with .Form.Errors.Get "trip-day"}}
                    <label class="text-danger">{{.}}</label>
                {{end}}
                <input class="form-control" {{with .Form.Errors.Get "trip-day"}} is-invalid {{end}}
                    id="trip-day" autocomplete="off" type='number'
                    name='trip-day' min="1" max="31" value="{{ if $t }}{{ $t.TripDate.Day }}{{else}}{{.Form.Get "trip-day"}}{{end}}" required>
            </div>
        </div>
        <div class="col">
            <div class="form-group mt-3">
                <label for="start-mileage">Start (readonly):</label>
                {{with .Form.Errors.Get "start-mileage"}}
                    <label class="text-danger">{{.}}</label>
                {{end}}
                <input class="form-control" {{with .Form.Errors.Get "start-mileage"}} is-invalid {{end}}
                    id="start-mileage" autocomplete="off" type='number'
                    name='start-mileage' min="0" max="999" value="{{ if $t }}{{ $t.StartMileage }}{{else}}{{ index .IntMap "last-odometer-value" }}{{end}}" readonly>
            </div>
        </div>
        <div class="col">
            <div class="form-group mt-3">
                <label for="end-mileage-input">End (last 3 digits):</label>
                {{with .Form.Errors.Get "end-mileage-input"}}
                    <label class="text-danger">{{.}}</label>
                {{end}}
                <input class="form-control" {{with .Form.Errors.Get "end-mileage-input"}} is-invalid {{end}}
                    id="end-mileage-input" autocomplete="off" type='number'
                    name='end-mileage-input' min="0" max="999" value="{{ if $t }}{{ $t.EndMileage }}{{else}}{{.Form.Get "end-mileage-input"}}{{end}}" required>
            </div>
        </div>
        <div class="col">
            <div class="form-group mt-3">
                <label for="destination">Destination:</label>
                {{with .Form.Errors.Get "destination"}}
                    <label class="text-danger">{{.}}</label>
                {{end}}
                <input class="form-control" {{with .Form.Errors.Get "destination"}} is-invalid {{end}}
                    id="destination" autocomplete="off" type='text'
                    name='destination' value="{{ if $t }}{{ $t.Destination }}{{else}}{{.Form.Get "destination"}}{{end}}">
            </div>
        </div>
        <div class="col">
            <div class="form-group mt-3">
                <label for="purpose">Purpose:</label>
                {{with .Form.Errors.Get "purpose"}}
                    <label class="text-danger">{{.}}</label>
                {{end}}
                <input class="form-control" {{with .Form.Errors.Get "purpose"}} is-invalid {{end}}
                    id="purpose" autocomplete="off" type='text'
                    name='purpose' value="{{ if $t }}{{ $t.Purpose }}{{else}}{{.Form.Get "purpose"}}{{end}}">
            </div>
        </div>
        <div class="col">
            <div class="form-group mt-3">
                <label class="form-check-label" for="is-ld">LD?:</label>
                {{with .Form.Errors.Get "is-ld"}}
                    <label class="text-danger">{{.}}</label>
                {{end}}
                <input class="form-check-input" {{with .Form.Errors.Get "is-ld"}} is-invalid {{end}}
                    id="is-ld" autocomplete="off" type='checkbox'
                    name='is-ld' value="ld" {{if $t.IsLongDistance }}checked{{end}} >
            </div>
        </div>
        <div class="col">
                    <div class="form-group mt-3">
                        <label class="form-check-label" for="ld-days">LD Days?:</label>
                        {{with .Form.Errors.Get "ld-days"}}
                            <label class="text-danger">{{.}}</label>
                        {{end}}
                        <select class="form-select" aria-label="Long Distance Days Select" id="ld-days"
                                    name="ld-days" required>
                                    {{ range index .Data "ld-days" }}
                                        <option value="{{.}}" {{if eq . $t.BillingRate }} selected {{ end }}>{{.}}</option>
                                    {{ end }}
                                </select>
                    </div>
                </div>
                <div class="col">
                    <div class="form-group mt-3">
                        <label class="form-check-label" for="billing-rate">Rate:</label>
                        {{with .Form.Errors.Get "billing-rate"}}
                            <label class="text-danger">{{.}}</label>
                        {{end}}
                        <select class="form-select" aria-label="Billing Rate Select" id="billing-rate"
                                    name="billing-rate" required>
                                    {{ range index .Data "billing-rates" }}
                                        <option value="{{.}}" {{if eq . $t.BillingRate }} selected {{ end }}>{{.}}</option>
                                    {{ end }}
                                </select>
                    </div>
                </div>
    </div>
    <div class="row">
        <div class="col">
            <label for="riders">Riders:</label>
            {{with .Form.Errors.Get "riders"}}
                    <label class="text-danger">{{.}}</label>
            {{end}}
        </div>
    </div>
    <div class="row">
        <div class="col">
            <select id="riders" name="riders" {{with .Form.Errors.Get "riders"}} is-invalid {{end}}
                placeholder="Select riders..." multiple required>
            {{ if $t }}
                {{range $t.Riders }}
                    <option value="{{.ID}}" selected>{{.Name}}</option>
                {{end}}
            {{ end }}
            </select>
        </div>
    </div>
    <div class="row mt-2">
        <div class="col">
            <input type="submit" class="btn btn-primary" value="Save Trip">
        </div>
    </div>
</form>
{{end}}


{{ define "tripEditForm" }}
{{ $t := index .Data "trip" }}
<tr id="trip-{{$t.ID}}">
    <td colspan="8">
        <form hx-post="/trip-edit/{{$t.ID}}" hx-trigger="submit" hx-target="#trip-list" hx-swap="outerHTML" novalidate>
            <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">
            <div class="row">
                <div class="col">
                    <div class="form-group mt-3">
                        <label for="trip-day">Day:</label>
                        {{with .Form.Errors.Get "trip-day"}}
                            <label class="text-danger">{{.}}</label>
                        {{end}}
                        <input class="form-control" {{with .Form.Errors.Get "trip-day"}} is-invalid {{end}}
                            id="trip-day" autocomplete="off" type='number'
                            name='trip-day' min="1" max="31" value="{{ if $t }}{{ $t.TripDate.Day }}{{else}}{{.Form.Get "trip-day"}}{{end}}" required>
                    </div>
                </div>
                <div class="col">
                    <div class="form-group mt-3">
                        <label for="start-mileage">Start (readonly):</label>
                        {{with .Form.Errors.Get "start-mileage"}}
                            <label class="text-danger">{{.}}</label>
                        {{end}}
                        <input class="form-control" {{with .Form.Errors.Get "start-mileage"}} is-invalid {{end}}
                            id="start-mileage" autocomplete="off" type='number'
                            name='start-mileage' min="0" max="999" value="{{ if $t }}{{ $t.StartMileage }}{{else}}{{ index .IntMap "last-odometer-value" }}{{end}}" readonly>
                    </div>
                </div>
                <div class="col">
                    <div class="form-group mt-3">
                        <label for="end-mileage">End:</label>
                        {{with .Form.Errors.Get "end-mileage"}}
                            <label class="text-danger">{{.}}</label>
                        {{end}}
                        <input class="form-control" {{with .Form.Errors.Get "end-mileage"}} is-invalid {{end}}
                            id="end-mileage" autocomplete="off" type='number'
                            name='end-mileage' min="0" max="999" value="{{ if $t }}{{ $t.EndMileage }}{{else}}{{.Form.Get "end-mileage"}}{{end}}" required>
                    </div>
                </div>
                <div class="col">
                    <div class="form-group mt-3">
                        <label for="destination">Destination:</label>
                        {{with .Form.Errors.Get "destination"}}
                            <label class="text-danger">{{.}}</label>
                        {{end}}
                        <input class="form-control" {{with .Form.Errors.Get "destination"}} is-invalid {{end}}
                            id="destination" autocomplete="off" type='text'
                            name='destination' value="{{ if $t }}{{ $t.Destination }}{{else}}{{.Form.Get "destination"}}{{end}}">
                    </div>
                </div>
                <div class="col">
                    <div class="form-group mt-3">
                        <label for="purpose">Purpose:</label>
                        {{with .Form.Errors.Get "purpose"}}
                            <label class="text-danger">{{.}}</label>
                        {{end}}
                        <input class="form-control" {{with .Form.Errors.Get "purpose"}} is-invalid {{end}}
                            id="purpose" autocomplete="off" type='text'
                            name='purpose' value="{{ if $t }}{{ $t.Purpose }}{{else}}{{.Form.Get "purpose"}}{{end}}">
                    </div>
                </div>
                <div class="col">
                    <div class="form-group mt-3">
                        <label class="form-check-label" for="is-ld">LD?:</label>
                        {{with .Form.Errors.Get "is-ld"}}
                            <label class="text-danger">{{.}}</label>
                        {{end}}
                        <input class="form-check-input" {{with .Form.Errors.Get "is-ld"}} is-invalid {{end}}
                            id="is-ld" autocomplete="off" type='checkbox'
                            name='is-ld' value="ld" {{if $t.IsLongDistance }}checked{{end}} >
                    </div>
                </div>
                <div class="col">
                    <div class="form-group mt-3">
                        <label class="form-check-label" for="ld-days">LD Days?:</label>
                        {{with .Form.Errors.Get "ld-days"}}
                            <label class="text-danger">{{.}}</label>
                        {{end}}
                        <select class="form-select" aria-label="Long Distance Days Select" id="ld-days"
                                    name="ld-days" required>
                                    {{ range index .Data "ld-days" }}
                                        <option value="{{.}}" {{if eq . $t.LongDistanceDays }} selected {{ end }}>{{.}}</option>
                                    {{ end }}
                                </select>
                    </div>
                </div>
                <div class="col">
                    <div class="form-group mt-3">
                        <label class="form-check-label" for="billing-rate">Rate:</label>
                        {{with .Form.Errors.Get "billing-rate"}}
                            <label class="text-danger">{{.}}</label>
                        {{end}}
                        <select class="form-select" aria-label="Billing Rate Select" id="billing-rate"
                                    name="billing-rate" required>
                                    {{ range index .Data "billing-rates" }}
                                        <option value="{{.}}" {{if eq . $t.BillingRate }} selected {{ end }}>{{.}}</option>
                                    {{ end }}
                                </select>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <label for="riders">Riders:</label>
                    {{with .Form.Errors.Get "riders"}}
                            <label class="text-danger">{{.}}</label>
                    {{end}}
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <select id="riders" name="riders" {{with .Form.Errors.Get "riders"}} is-invalid {{end}}
                        placeholder="Select riders..." multiple required>
                    {{ if $t }}
                        {{range $t.Riders }}
                            <option value="{{.ID}}" selected>{{.Name}}</option>
                        {{end}}
                    {{ end }}
                    </select>
                </div>
            </div>
            <div class="row mt-2">
                <div class="col">
                    <input type="submit" class="btn btn-primary" value="Update Trip">
                </div>
            </div>
        </form>
    </td>
</tr>
{{end}}

{{define "tripHeader"}}
<tr>
    <th scope="col">Day</th>
    <th scope="col">Start</th>
    <th scope="col">End</th>
    <th scope="col">LD Days</th>
    <th scope="col">Riders</th>
    <th scope="col">Destination</th>
    <th scope="col">Purpose</th>
    <th scope="col">Distance</th>
    <th scope="col">Use Rate</th>
    <th scope="col">Cost</th>
    <th scope="col"></th>
</tr>
{{end}}

{{define "tripRow"}}
<tr id="trip-{{.ID}}" {{if ne .LongDistanceDays 0 }} class="table-info" {{else}}{{if gt .Distance 300.0 }}class="table-warning"{{end}}{{end}}>
    <td>{{ .TripDate.Format "2006-01-02" }}</td>
    <td> {{ .StartMileage }}</td>
    <td> {{ .EndMileage }}</td>
    <td> {{ if ne .LongDistanceDays 0 }}{{ .LongDistanceDays }}{{end}}</td>
    <td> 
        {{ range .Riders }}
            [{{ .Name }}]
        {{ end }}
    </td>
    <td> {{ .Destination }}</td>
    <td> {{ .Purpose }}</td>
    <td> {{ .Distance }}</td>
    <td> {{ .BillingRate }}</td>
    <td> {{ .Cost }}</td>
    <td> 
        <button hx-get="/trip-edit/{{.ID}}" hx-target="#trip-{{.ID}}" hx-swap="outerHTML" type="button" class="btn btn-primary">
            Edit 
        </button>
    </td>
</tr>
{{end}}

{{define "tripRowSwap"}}
    {{ $t := index .Data "trip"}}
    {{template "tripRow" $t}}
{{end}}

{{define "tripTableSwap"}}
{{ $v := index .Data "mileage-log" }}
<table id="trip-list" hx-swap-oob="true" class="table table-sm table-striped">
    <thead>
        {{template "tripHeader" .}}
    </thead>
    <tbody>
        {{range $v.Trips}}
        {{template "tripRow" .}}
        {{ end }}
    </tbody>
</table>
{{end}}

{{define "tripEditTableSwap"}}
{{ $v := index .Data "mileage-log" }}
<table id="trip-list" class="table table-sm table-striped">
    <thead>
        {{template "tripHeader" .}}
    </thead>
    <tbody>
        {{range $v.Trips}}
        {{template "tripRow" .}}
        {{ end }}
    </tbody>
</table>
{{end}}